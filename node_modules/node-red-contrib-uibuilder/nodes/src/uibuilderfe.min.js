"use strict";if("undefined"!=typeof require&&void 0===io)var io=require("socket.io-client");(function(){var e=this,t=e.uibuilder,n=function(){String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)});var o=this;return o.version="1.2.2",o.debug=!0,o.uiDebug=function(){if(o.debug){var e=arguments[0];console[e].apply(void 0,[].slice.call(arguments,1))}},o.me=function(){return!0===o.debug?o:"uibuilderfe.js Version: "+o.version},o.setIOnamespace=function(){var e="";if(""===(e=document.cookie.replace(/(?:(?:^|.*;\s*)uibuilder-namespace\s*\=\s*([^;]*?).*$)|^.*$/,"$1"))){var t=window.location.pathname.split("/").filter(function(e){return""!==e.trim()});t[t.length-1].endsWith(".html")&&t.pop(),e=t.join("/")}return e="/"+e,o.uiDebug("log","uibuilderfe: IO Namespace: "+e),e},o.autoSendReady=!0,o.allowScript=!0,o.allowStyle=!0,o.removeScript=!0,o.removeStyle=!0,o.msg={},o.ctrlMsg={},o.sentMsg={},o.msgsSent=0,o.msgsReceived=0,o.msgsSentCtrl=0,o.msgsCtrl=0,o.ioConnected=!1,o.ioChannels={control:"uiBuilderControl",client:"uiBuilderClient",server:"uiBuilder"},o.retryMs=2e3,o.retryFactor=1.5,o.timerid=null,o.ioNamespace=o.setIOnamespace(),o.ioPath="/uibuilder/socket.io",o.ioTransport=["polling","websocket"],o.set=function(e,t){o[e]=t,o.uiDebug("debug","uibuilderfe: prop set - prop: "+e+", val: "+("object"==typeof t)?JSON.stringify(t):t),o.emit(e,t)},o.uiDebug("debug","uibuilderfe: About to create IO. Namespace: "+o.ioNamespace+", Path: "+o.ioPath+", Transport: ["+o.ioTransport.join(", ")+"]"),o.socket=io(o.ioNamespace,{path:o.ioPath,transports:o.ioTransport}),o.checkConnect=function(e,t){var n=n++||1;o.uiDebug("debug","uibuilderfe:checkConnect. Reconnect - Depth: "+n+", Delay: "+e+", Factor: "+t),o.timerid&&window.clearTimeout(o.timerid),o.timerid=window.setTimeout(function(){o.uiDebug("debug","uibuilderfe:checkConnect timeout. SIO reconnect attempt, timeout: "+e+", depth: "+n),o.socket.close(),o.socket.connect(),o.timerid=null,o.checkConnect(e*t,t)},e)},o.socket.on("connect",function(){o.uiDebug("info","uibuilderfe: SOCKET CONNECTED - Namespace: "+o.ioNamespace," Server Channel: ",o.ioChannels.server," Control Channel: ",o.ioChannels.control),o.set("ioConnected",!0),o.timerid&&(window.clearTimeout(o.timerid),o.timerid=null)}),o.socket.on(o.ioChannels.server,function(e){o.uiDebug("debug","uibuilderfe:"+o.ioChannels.server+" (server): msg received - Namespace: "+o.ioNamespace,e),e=i(e,"payload"),o.allowScript&&e.hasOwnProperty("script")&&(o.newScript(e.script),o.removeScript&&delete e.script),o.allowStyle&&e.hasOwnProperty("style")&&(o.newStyle(e.style),o.removeStyle&&delete e.style),o.set("msg",e),o.set("msgsReceived",o.msgsReceived+1),e.hasOwnProperty("serverTimestamp")&&o.uiDebug("log","uibuilderfe:"+o.ioChannels.server+" (server): Offset is: "+(new Date-e.serverTimestamp))}),o.socket.on(o.ioChannels.control,function(e){if(o.uiDebug("debug","uibuilder:"+o.ioChannels.control+" (control): msg received - Namespace: "+o.ioNamespace,e),null===e)e={};else if("object"!=typeof e){var t={};t["uibuilderCtrl:"+o.ioChannels.control]=e,e=t}e.hasOwnProperty("debug")&&(o.debug=e.debug),o.set("ctrlMsg",e),o.set("msgsCtrl",o.msgsCtrl+1)}),o.socket.on("disconnect",function(e){o.uiDebug("info","uibuilderfe:SOCKET DISCONNECTED - Namespace: "+o.ioNamespace+", Reason: "+e),o.set("ioConnected",!1),"io server disconnect"===e&&o.checkConnect(o.retryMs,o.retryFactor)}),o.send=function(e,t){null==t&&(t=o.ioChannels.client),o.uiDebug("debug","uibuilderfe: sending msg - Namespace: "+o.ioNamespace+", Channel: "+t,e),t===o.ioChannels.client?e=i(e,"payload"):t===o.ioChannels.control&&((e=i(e,"uibuilderCtrl")).hasOwnProperty("uibuilderCtrl")||(e.uibuilderCtrl="manual send"),e.from="client"),o.set("sentMsg",e),t===o.ioChannels.client?o.set("msgsSent",o.msgsSent+1):t===o.ioChannels.control&&o.set("msgsCtrl",o.msgsCtrl+1),o.socket.emit(t,e)},o.events={},o.emit=function(e){var t=o.events[e];if(t)for(var n=Array.prototype.slice.call(arguments,1),i=0;i<t.length;i++)t[i].apply(o,n)},o.newScript=function(e){if(!0===o.allowScript&&""!==e&&void 0!==e){o.uiDebug("log","uibuilderfe: newCode - script: "+e);var t=document.createElement("script");t.type="text/javascript",t.defer=!0,t.textContent=e,document.getElementsByTagName("body")[0].appendChild(t)}},o.newStyle=function(e){if(!0===o.allowStyle&&""!==e&&void 0!==e){o.uiDebug("log","uibuilderfe: newStyle - style: "+e);var t=document.createElement("style");t.textContent=e,document.getElementsByTagName("head")[0].appendChild(t)}},o.uiReturn={set:function(e,t){-1===["version","debug","msg","ctrlMsg","sentMsg","msgsSent","msgsSentCtrl","msgsReceived","msgsCtrl","ioConnected","ioChannels","retryMs","retryFactor","timerid","ioNamespace","ioPath","ioTransport","events","autoSendReady","set","get","send","sendCtrl","onChange","socket","checkConnect","emit","uiReturn","newScript","newStyle","uiDebug","me","self","setIOnamespace"].indexOf(e)?o.set(e,t):o.uiDebug("warn",'uibuilderfe:uibuilder:set: "'+e+'" is in list of excluded properties, not set')},get:function(e){return o[e]},onChange:function(e,t){o.events[e]?o.events[e].push(t):o.events[e]=[t]},msg:o.msg,send:o.send,sendCtrl:function(e){o.send(e,o.ioChannels.control)},autoSendReady:function(e){!0!==e&&(e=!1),o.autoSendReady=e},debug:function(e){if(void 0===e)return o.debug;"boolean"==typeof e&&(o.debug=e)},uiDebug:o.uiDebug,me:o.me},window.addEventListener("load",function(){!0===o.autoSendReady&&o.send({uibuilderCtrl:"ready for content",cacheControl:"REPLAY",from:"client"},o.ioChannels.control)}),o.checkConnect(o.retryMs,o.retryFactor),o.uiReturn}.call(e);function i(e,t){null==t&&(t="payload"),"string"!=typeof t&&(console.warn("makeMeAnObject:WARNING: property parameter must be a string and not: "+typeof t),t="payload");var n={};return"object"==typeof e?n=e:null!==e&&(n[t]=e),n}n.noConflict=function(){return e.uibuilder=t,n},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.uibuilder=n):e.uibuilder=n}).call(this);